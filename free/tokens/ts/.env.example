# =============================================================================
# Tokens Plugin Configuration
# =============================================================================
# Copy this file to .env and configure for your environment
# Documentation: See README.md for detailed configuration guide

# -----------------------------------------------------------------------------
# Required Variables (Plugin will not start without these)
# -----------------------------------------------------------------------------

# Database connection string
# Format: postgresql://user:password@host:port/database
DATABASE_URL=postgresql://postgres:password@localhost:5432/nself_db

# Encryption key for secure credential storage
# Generate with: openssl rand -base64 32
TOKENS_ENCRYPTION_KEY=

# -----------------------------------------------------------------------------
# Server Configuration
# -----------------------------------------------------------------------------

# Server port (default: 3107)
TOKENS_PLUGIN_PORT=3107

# Logging level (debug|info|warn|error) - default: info
LOG_LEVEL=info

# -----------------------------------------------------------------------------
# Multi-App Configuration (Optional)
# -----------------------------------------------------------------------------

# Comma-separated list of app IDs to serve
# If not set, serves all apps
TOKENS_APP_IDS=

# -----------------------------------------------------------------------------
# Token Settings
# -----------------------------------------------------------------------------

# Default token TTL in seconds (default: 3600 = 1 hour)
# How long access tokens remain valid
TOKENS_DEFAULT_TTL_SECONDS=3600

# Maximum allowed TTL in seconds (default: 86400 = 24 hours)
# Prevents tokens from being issued with excessively long lifetimes
TOKENS_MAX_TTL_SECONDS=86400

# -----------------------------------------------------------------------------
# HLS Encryption Settings
# -----------------------------------------------------------------------------

# Enable HLS AES-128 encryption (true|false, default: false)
# When enabled, generates encryption keys for HLS segments
TOKENS_HLS_ENCRYPTION_ENABLED=false

# -----------------------------------------------------------------------------
# Entitlement Checks
# -----------------------------------------------------------------------------

# Perform entitlement checks by default (true|false, default: true)
# Verifies user has access to content before issuing token
TOKENS_DEFAULT_ENTITLEMENT_CHECK=true

# Allow access if no entitlements are configured (true|false, default: false)
# When true, grants access if no entitlement rules exist
# When false, denies access if no entitlement rules exist
TOKENS_ALLOW_ALL_IF_NO_ENTITLEMENTS=false

# -----------------------------------------------------------------------------
# Token Use Cases
# -----------------------------------------------------------------------------
# Signed Access Tokens:
#   - Time-limited URLs for HLS playlists and segments
#   - Secure content delivery without exposing direct URLs
#   - Prevents URL sharing and unauthorized access
#
# HLS Encryption:
#   - AES-128 encryption for HLS video segments
#   - Key rotation for enhanced security
#   - Compatible with all major HLS players
#
# Entitlement System:
#   - Content-level access control
#   - User/group-based permissions
#   - Subscription and purchase validation
#   - Geographic restrictions
#
# Integration Points:
#   - Stream Gateway: Validates tokens before streaming
#   - CDN: Serves content with signed URLs
#   - Player: Requests tokens for playback
#   - Backend: Issues tokens after auth checks

# -----------------------------------------------------------------------------
# Security Recommendations
# -----------------------------------------------------------------------------
# 1. Encryption Key:
#    - Generate a strong random key (32+ bytes)
#    - Store securely (environment variable, secrets manager)
#    - Rotate periodically (invalidates existing tokens)
#
# 2. Token TTL:
#    - Use short TTLs for maximum security (3600s recommended)
#    - Longer TTLs for offline/mobile scenarios
#    - Implement token refresh for long sessions
#
# 3. HLS Encryption:
#    - Enable for premium/protected content
#    - Key rotation: Generate new keys periodically
#    - Combine with DRM for additional protection
#
# 4. Entitlements:
#    - Always validate entitlements in production
#    - Set TOKENS_ALLOW_ALL_IF_NO_ENTITLEMENTS=false
#    - Implement comprehensive entitlement rules

# -----------------------------------------------------------------------------
# Cleanup Schedule
# -----------------------------------------------------------------------------
# Expired tokens are automatically cleaned up every 4 hours
# Cron schedule: 0 */4 * * * (configured in plugin.json)
