# =============================================================================
# Content Progress Plugin Configuration
# =============================================================================
# Copy this file to .env and configure for your environment
# Documentation: See README.md for detailed configuration guide

# -----------------------------------------------------------------------------
# Required Variables (Plugin will not start without these)
# -----------------------------------------------------------------------------

# Database connection string
# Format: postgresql://user:password@host:port/database
DATABASE_URL=postgresql://postgres:password@localhost:5432/nself_db

# -----------------------------------------------------------------------------
# Server Configuration
# -----------------------------------------------------------------------------

# Server port (default: 3022)
PROGRESS_PLUGIN_PORT=3022

# Logging level (debug|info|warn|error) - default: info
LOG_LEVEL=info

# -----------------------------------------------------------------------------
# Progress Tracking Settings
# -----------------------------------------------------------------------------

# Completion threshold percentage (default: 95)
# Content is marked as "completed" when progress reaches this percentage
# Example: 95 means 95% or more is considered fully watched
PROGRESS_COMPLETE_THRESHOLD=95

# History sample interval in seconds (default: 30)
# How often to record playback position snapshots
# Smaller values = more granular history, larger database
PROGRESS_HISTORY_SAMPLE_SECONDS=30

# History retention in days (default: 365)
# How long to keep playback history records
# Old history is automatically cleaned up
PROGRESS_HISTORY_RETENTION_DAYS=365

# -----------------------------------------------------------------------------
# API Security (Optional)
# -----------------------------------------------------------------------------

# API key for securing plugin endpoints
# If set, all API requests must include this key
PROGRESS_API_KEY=

# Rate limiting - max requests per window (default: 100)
PROGRESS_RATE_LIMIT_MAX=100

# Rate limiting - window duration in milliseconds (default: 60000 = 1 minute)
PROGRESS_RATE_LIMIT_WINDOW_MS=60000

# -----------------------------------------------------------------------------
# Features
# -----------------------------------------------------------------------------
# Continue Watching:
#   - Tracks playback position for all content
#   - Resume from last watched position
#   - Automatically marks content as completed
#   - Syncs across all devices
#
# Watchlist:
#   - Add content to personal watchlist
#   - Remove content from watchlist
#   - Query watchlist items
#   - Track when items were added
#
# Favorites:
#   - Mark content as favorite
#   - Remove from favorites
#   - Query favorite items
#   - Sync across devices
#
# Playback History:
#   - Detailed history of all playback sessions
#   - Track watch patterns and viewing habits
#   - Sample-based recording (configurable interval)
#   - Automatic cleanup of old history

# -----------------------------------------------------------------------------
# Webhook Events
# -----------------------------------------------------------------------------
# The plugin emits these webhook events:
#
# progress.updated - Playback position was updated
# progress.completed - Content was marked as completed
# watchlist.added - Content was added to watchlist
# watchlist.removed - Content was removed from watchlist
# favorite.added - Content was added to favorites
# favorite.removed - Content was removed from favorites

# -----------------------------------------------------------------------------
# Database Tables
# -----------------------------------------------------------------------------
# np_progress_positions:
#   - Current playback position for each content item
#   - Per-user isolation via source_account_id
#   - Tracks: position, duration, percentage, updated_at
#
# np_progress_history:
#   - Historical playback snapshots
#   - Sampled at configurable intervals
#   - Useful for analytics and viewing patterns
#
# np_progress_watchlists:
#   - User watchlist items
#   - Tracks when items were added
#   - Per-user isolation
#
# np_progress_favorites:
#   - User favorite items
#   - Similar to watchlist
#   - Separate list for favorited content
#
# np_progress_webhook_events:
#   - Webhook event log
#   - Tracks all emitted events

# -----------------------------------------------------------------------------
# Integration Points
# -----------------------------------------------------------------------------
# Video Players:
#   - Send progress updates every N seconds
#   - Request last position on load
#   - Mark as completed when threshold reached
#
# Content Libraries:
#   - Show "Continue Watching" section
#   - Display watchlist and favorites
#   - Track which content is most popular
#
# Analytics:
#   - Use history table for viewing patterns
#   - Track completion rates
#   - Identify popular content
